---
title: "09_prescribed_burns_aqd"
author: "Puvvula"
date: "11/12/2021"
output: pdf_document
---

```{r}
library(tidyverse)
library(lubridate)
library(zoo)
library(splines)
library(tsModel)
library(dlnm)
library(mgcv)
library(ggstatsplot)

df<- read_csv("/work/jessebell/puvvula/aqd_final_data/pAsthma_imputed.csv")

#Formatting and creating new TS variables
df$date<- as.Date(df$date, format = "%m/%d/%Y")
df <- df %>% mutate(year = year(date),
                          month = month(date, label=TRUE),
                          day = day(date))

df$dow <- wday(as.Date(df$date, format = "%m/%d/%Y"))
weekdays1 <- c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
df$wDay <- factor((weekdays(df$date) %in% weekdays1), 
                       levels=c(FALSE, TRUE), labels=c('weekend', 'weekday'))
df$week_num<- week(ymd(df$date))

#year to quarter conversion use zoo library for as.nearmon function
yq <- as.yearqtr(as.yearmon(df$date, "%Y %m/%d/") + 1/12)
df$season <- factor(format(yq, "%q"), levels = 1:4,
                     labels = c("winter", "spring", "summer", "fall"))

#Save data with ts variables
write_csv(df,"/work/jessebell/puvvula/aqd_final_data/p_burn_asth.csv")

```

Start here

```{r}
library(tidyverse)
library(lubridate)
library(zoo)
library(splines)
library(tsModel)
library(dlnm)
library(mgcv)
library(ggstatsplot)


dat<- read_csv("/work/jessebell/puvvula/aqd_final_data/p_burn_asth.csv")
dat$month<-as.factor(dat$month)
dat$wDay<-as.factor(dat$wDay)
dat$dow<-as.factor(dat$dow)

#Excluding pollen dominant months
filter_month<- c("Jan","Feb","Mar","Apr")
df<- subset(dat, month %in% filter_month)
```

```{r}
set.seed(2021)
#group mean difference testing : Burn and non-burn season

# Asthma exacerbations
ggbetweenstats(df,pres_burn,p_ast)
#Observed significantly greater ER visits during burn season (b=3.14 > nb=1.93 )

#PM10
ggbetweenstats(dat,pres_burn,cp_07)
#Significantly difference (b=26.65 >nb=17.40)

#PM2.5
ggbetweenstats(dat,pres_burn,cp_08)
#Non-significantly difference (b=17.34 ~ nb=17.28)
```

Correlation between PM and ped asthma
PM10 - lag 0 -    6.37
PM10 - lag 1 -    9.17
PM10 - lag 2 -    5.33
PM10 - lag 3 -    10.48
PM10 - lag 4 -    9.50
PM10 - lag 5 -    7.20

PM2.5 - lag 0 -     -0.39
PM2.5 - lag 1 -     -0.39
PM2.5 - lag 2 -     -0.48
PM2.5 - lag 3 -     0.76
PM2.5 - lag 4 -     -0.57
PM2.5 - lag 5 -     -5.24

```{r}
#Start modeling with PM10 and pediatric asthma

#GLM
library(stats)
library(splines)
library(tsModel)
library(mda)
library(lattice)
library(MASS)

df.nburn<- df %>% subset(pres_burn=="0")
df.burn<- df %>% subset(pres_burn=="1")

fit.burn<- glm.nb(p_ast ~ Lag(cp_07, 0:5)+TMAX,data = df.burn)
summary(fit.burn)

#DLNM


```

